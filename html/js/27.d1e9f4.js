webpackJsonp([27],{1464:function(t,o,e){t.exports=e.p+"image/icon_dz.e8ca6c.png"},1977:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e(1978),s=e.n(i);for(var a in i)"default"!==a&&function(t){e.d(o,t,function(){return i[t]})}(a);o.default=s.a},1978:function(t,o,e){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(o,"__esModule",{value:!0});var s=e(52),a=i(s),n=e(461);i(n);o.default={data:function(){return{rootId:"",title:"",item:{},longitude:"",latitude:"",address:"",moreAddress:"",describe:"",list:[{name:"",value:"",type:"input",placeholder:"地址补充说明（非必填）",maxlength:15}],photoList:[],photoList2:[],disposeResult:"",autoHandle:!0,isdispose:!0,newLocation:{}}},watch:{autoHandle:function(t){this.isdispose=1==t}},created:function(){},mounted:function(){this.rootId=this.$route.query.id,this.title=this.$route.query.title,this.item=this.$route.query.item,this._getLocation(),this.$store.state.patrolReportStorage[this.item.id]&&(console.log("有暂存数据："),console.log(this.$store.state.patrolReportStorage[this.item.id]),console.log(this.$store.state.patrolReportStorage),this.$set(this.list[0],"model",this.$store.state.patrolReportStorage[this.item.id].moreAddress),this.newLocation=this.$store.state.patrolReportStorage[this.item.id].newLocation,this.describe=this.$store.state.patrolReportStorage[this.item.id].describe,this.photoList=this.$store.state.patrolReportStorage[this.item.id].photoList,this.autoHandle=this.$store.state.patrolReportStorage[this.item.id].autoHandle),void 0!==this.newLocation&&null!==this.newLocation&&(console.log(this.newLocation),this.address=this.newLocation.address),this._getCurrentLocation()},computed:{buttonName:function(){return this.autoHandle?"提交至我的待办":"上报"}},methods:{_getLocation:function(){var t=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(this._showPosition,function(o){switch(console.log("进入定位错误回调"),console.log(o.message),o.code){case o.PERMISSION_DENIED:console.log("用户拒绝对获取地理位置的请求。");break;case o.POSITION_UNAVAILABLE:console.log("位置信息是不可用的。");break;case o.TIMEOUT:console.log("请求用户地理位置超时。");break;case o.UNKNOWN_ERROR:console.log("未知错误。")}setTimeout(t._getLocation,500)},{enableHighAccuracy:!1,timeout:1e4,maximumAge:0}):alert("是否开启了GPS功能")},_showPosition:function(t){isNull(t.coords.longitude)?toast("坐标为空,请重新定位"):(console.log("定位成功，进入_showPosition"),window.longitude=t.coords.longitude,window.latitude=t.coords.latitude,window.choiceLongitude=t.coords.longitude,window.choiceLatitude=t.coords.latitude)},_getCurrentLocation:function(){var t=this,o=new BMap.Geolocation;o.enableSDKLocation(),o.getCurrentPosition(function(e){console.log((0,a.default)(e)),o.getStatus()==BMAP_STATUS_SUCCESS?(console.log("地址："+e.address.province+e.address.city+e.address.district+e.address.street+e.address.street_number),t.address=e.address.province+e.address.city+e.address.district+e.address.street+e.address.street_number,console.log(t.address)):console.log("定位failed："+o.getStatus())})},back:function(){var t=this;console.log("点击返回"),app.$createPotDialog({$props:{type:"confirm",confirmBtn:"暂存",cancelBtn:"否",content:"您的问题还未上报，是否进行暂存？",maskClosable:!0},$events:{confirm:function(){void 0===t.$store.state.patrolReportStorage[t.item.id]&&(t.$store.state.patrolReportStorage[t.item.id]={}),t.$store.state.patrolReportStorage[t.item.id].hasStorage=!0,t.$store.state.patrolReportStorage[t.item.id].moreAddress=t.list[0].model,t.$store.state.patrolReportStorage[t.item.id].newLocation=t.newLocation,t.$store.state.patrolReportStorage[t.item.id].describe=t.describe,t.$store.state.patrolReportStorage[t.item.id].photoList=t.photoList,t.$store.state.patrolReportStorage[t.item.id].autoHandle=t.autoHandle,console.log(t.$store.state.patrolReportStorage[t.item.id]),t.$router.back()},cancel:function(){t.$store.state.patrolReportStorage[t.item.id]&&(t.$store.state.patrolReportStorage[t.item.id].hasStorage=!1),t.$router.back()}}}).show()},chooseLocation:function(){var t=this;this.$createChooseLocation({$props:{value:""},$events:{success:function(o){console.log("success"),t.newLocation=o,console.log(t.newLocation),t.address=t.newLocation.address}}}).show()},clickBtn:function(){console.log(this.autoHandle),console.log(this.list[0].model),window.picture_array=this.photoList,window.picture_array2=this.photoList2,this.photoList||(window.picture_array=""),!isNull(window.picture_array)||window.picture_array.length>0?(window.picture_upImg="",this.publicOpinion_upPicture(window.picture_array[0],1)):this.submit(),this.autoHandle},submit:function(){var t=this;if(isNull(window.picture_array))toast("上报图片不能为空");else if(isNull(this.describe))toast("请输入问题描述");else{var o=(window.serverUrl,window.longitude),e=window.latitude,i="";i+=toJson("longitude",o)+"&",i+=toJson("latitude",e)+"&",i+=toJson("origin","4")+"&",i+=toJson("loginId",$.trim(window.localStorage.loginId))+"&",i+=toJson("eventComponent",this.rootId)+"&",i+=toJson("bigClass",this.item.id)+"&",i+=toJson("location",this.address)+"&",i+=toJson("problem",this.describe)+"&",i+=toJson("reportPics",window.picture_upImg)+"&",i+=toJson("questionStatus","1")+"&",i+=toJson("score",this.item.score)+"&",i+=toJson("dispose",this.autoHandle?"1":"0")+"&",i+=toJson("backPath",window.picture_upImg2)+"&",i+=toJson("disposeResult",this.disposeResult),doPost("MobileCaseReport.action",i,function(o){window.commitFlag=0,0==o.code?(toast(o.message),window.currstep="1",t.$router.push({path:"toDeal-index",query:{}})):toast(o.message)},"","")}},publicOpinion_upPicture:function(t,o){var e=this;console.log("图片张数："+window.picture_array.length+"；当前第"+o+"张");var i="";i+=toJson("base64Str",t),doPost("app_publicOpinion_upPic.action",i,function(t){if(0==t.code){if(o<parseInt(window.picture_array.length)){console.log("当前上传第:"+o+"张,下次上传第"+o+"张");var i=parseInt(o)+1;e.publicOpinion_upPicture(window.picture_array[o],i)}else console.log("图片上传结束");isNull(window.picture_upImg)?window.picture_upImg=t.datas.path:window.picture_upImg=window.picture_upImg+";"+t.datas.path,console.log("当前type"+o+"；总共张数："+window.picture_array.length),parseInt(o)==window.picture_array.length?(1==e.isdispose?isNull(window.picture_array2)?toast("处理图片不能为空"):e.xxcj_upLoadPic2(window.picture_array2[0],1):e.submit(),e.submit(),console.log("type和图片长度相等"+o)):console.log("type和图片长度不相等")}else toast(t.message)},"","")},xxcj_upLoadPic2:function(t){function o(o,e){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}(function(t,o){var e=this,i="";i+=toJson("base64Str",t),doPost("appWorkOrder_upLoadPic.action",i,function(t){if(0==t.code){if(console.log("1111111111111111当前上传第:"+o+"张,下次上传第"+o+"张"),o<parseInt(window.picture_array2.length)){console.log("当前上传第:"+o+"张,下次上传第"+o+"张");var i=parseInt(o)+1;xxcj_upLoadPic2(window.picture_array2[o],i)}else console.log("图片上传结束");isNull(window.picture_upImg2)?window.picture_upImg2=t.data:window.picture_upImg2=window.picture_upImg2+";"+t.data,parseInt(o)==window.picture_array2.length&&(e.submit(),isNull(source)||source)}else toast(t.message)},"","")})}}},1979:function(t,o){},2581:function(t,o,e){"use strict";var i=e(2582);e.d(o,"a",function(){return i.a}),e.d(o,"b",function(){return i.b})},2582:function(t,o,e){"use strict";e.d(o,"a",function(){return i}),e.d(o,"b",function(){return s});var i=function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("div",{staticClass:"inspect-detail"},[i("tk-header",t._g({on:{"left-click":t.back}},t.$listeners),[t._v("\n        "+t._s(t.title)+"\n    ")]),t._v(" "),i("tk-scroll",{staticClass:"detail-content"},[i("div",{staticClass:"title"},[t._v(t._s(t.item.dmmc))]),t._v(" "),i("div",{staticClass:"locate",on:{click:t.chooseLocation}},[i("span",[i("img",{staticClass:"location-img",attrs:{src:e(1464),alt:""}})]),t._v(" "),i("span",[t._v(t._s(t.address))])]),t._v(" "),i("tk-form",{attrs:{list:t.list}}),t._v(" "),i("tk-textarea",{attrs:{placeholder:"请输入问题描述",maxlength:"1000"},model:{value:t.describe,callback:function(o){t.describe=o},expression:"describe"}}),t._v(" "),i("div",{staticClass:"sub-title"},[t._v("上传问题图片")]),t._v(" "),i("tk-upload-photo",{attrs:{maxlength:"10"},model:{value:t.photoList,callback:function(o){t.photoList=o},expression:"photoList"}}),t._v(" "),i("tk-switch",{attrs:{name:"是否自行处理",value:t.autoHandle},model:{value:t.autoHandle,callback:function(o){t.autoHandle=o},expression:"autoHandle"}}),t._v(" "),t.isdispose?i("div",[i("div",{staticClass:"imgdispose"},[i("div",{staticClass:"sub-title"},[t._v("上传处理图片")]),t._v(" "),i("tk-upload-photo",{attrs:{maxlength:"10"},model:{value:t.photoList2,callback:function(o){t.photoList2=o},expression:"photoList2"}})],1),t._v(" "),i("tk-textarea",{attrs:{placeholder:"请输入处理描述",maxlength:"1000"},model:{value:t.disposeResult,callback:function(o){t.disposeResult=o},expression:"disposeResult"}})],1):t._e(),t._v(" "),i("tk-button",{staticClass:"detail-btn",on:{click:t.clickBtn}},[t._v(t._s(t.buttonName))])],1)],1)},s=[]},2583:function(t,o,e){"use strict";var i=e(1979),s=e.n(i);s.a},639:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e(2581),s=e(1977);for(var a in s)"default"!==a&&function(t){e.d(o,t,function(){return s[t]})}(a);var n=(e(2583),e(0)),r=Object(n.a)(s.default,i.a,i.b,!1,null,null,null);o.default=r.exports}});